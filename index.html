<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>éŸ³å£°äºˆå®šç™»éŒ²</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#ff9500">

  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icon-192.png">

  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="äºˆå®šç™»éŒ²">

  <link rel="stylesheet" href="style.css">
</head>

<body>
  <div class="app">
    <header>ğŸ¤ éŸ³å£°äºˆå®šç™»éŒ²</header>

    <main>
      <p class="hint">ãƒœã‚¿ãƒ³ã‚’é•·æŠ¼ã—ã—ã¦è©±ã—ã¦ãã ã•ã„</p>

      <button id="startBtn">é•·æŠ¼ã—ã§éŸ³å£°å…¥åŠ›</button>

      <ul id="scheduleList"></ul>
    </main>
  </div>

<script>
const startBtn = document.getElementById("startBtn");
const list = document.getElementById("scheduleList");

const SpeechRecognition =
  window.SpeechRecognition || window.webkitSpeechRecognition;

let recognition = null;
let pressTimer = null;

// éŸ³å£°èªè­˜APIãŒã‚ã‚‹ç«¯æœ«ã®ã¿åˆæœŸåŒ–
if (SpeechRecognition) {
  recognition = new SpeechRecognition();
  recognition.lang = "ja-JP";

  recognition.onresult = (event) => {
    const text = event.results[0][0].transcript;
    const li = document.createElement("li");
    li.textContent = text;
    list.appendChild(li);
    save();
  };

  recognition.onend = () => {
    startBtn.classList.remove("listening");
  };
}

// é•·æŠ¼ã—é–‹å§‹
const startRecording = () => {
  if (!recognition) return;
  recognition.start();
  startBtn.classList.add("listening");
};

// é•·æŠ¼ã—çµ‚äº†
const stopRecording = () => {
  clearTimeout(pressTimer);
  if (recognition) recognition.stop();
  startBtn.classList.remove("listening");
};

startBtn.addEventListener("touchstart", () => {
  pressTimer = setTimeout(startRecording, 300);
});
startBtn.addEventListener("mousedown", () => {
  pressTimer = setTimeout(startRecording, 300);
});

startBtn.addEventListener("touchend", stopRecording);
startBtn.addEventListener("mouseup", stopRecording);
startBtn.addEventListener("mouseleave", stopRecording);

function save() {
  const items = [];
  document.querySelectorAll("li").forEach(li => items.push(li.textContent));
  localStorage.setItem("schedules", JSON.stringify(items));
}

function load() {
  const data = JSON.parse(localStorage.getItem("schedules") || "[]");
  data.forEach(text => {
    const li = document.createElement("li");
    li.textContent = text;
    list.appendChild(li);
  });
}

load();

if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("service-worker.js");
}
</script>
</body>
</html>
