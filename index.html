<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>éŸ³å£°å…¥åŠ›ã§äºˆå®šç™»éŒ²</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#ff9500">

  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icon-192.png">

  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="äºˆå®šç™»éŒ²">

  <link rel="stylesheet" href="style.css">
</head>

<body>
  <div class="app">
    <header>ğŸ¤ éŸ³å£°äºˆå®šç™»éŒ²</header>

    <main>
      <p class="hint">ä¾‹ï¼šã€Œæ˜æ—¥ã®15æ™‚ã«æ­¯åŒ»è€…ã€</p>
      <p id="deviceMsg" class="hint"></p>

      <button id="startBtn">éŸ³å£°å…¥åŠ›é–‹å§‹</button>

      <ul id="scheduleList"></ul>
    </main>
  </div>

<script>
const startBtn = document.getElementById("startBtn");
const list = document.getElementById("scheduleList");
const deviceMsg = document.getElementById("deviceMsg");

const isAndroid = /Android/i.test(navigator.userAgent);

const SpeechRecognition =
  window.SpeechRecognition || window.webkitSpeechRecognition;

if (!isAndroid) {
  startBtn.disabled = true;
  deviceMsg.textContent = "âš ï¸ éŸ³å£°å…¥åŠ›ã¯Androidç«¯æœ«ã®ã¿å¯¾å¿œã—ã¦ã„ã¾ã™";
}

if (isAndroid && SpeechRecognition) {
  const recognition = new SpeechRecognition();
  recognition.lang = "ja-JP";

  startBtn.onclick = () => {
    recognition.start();
    startBtn.classList.add("listening");
  };

  recognition.onresult = (event) => {
    const text = event.results[0][0].transcript;
    const li = document.createElement("li");
    li.textContent = text;
    list.appendChild(li);
    save();
  };

  recognition.onend = () => {
    startBtn.classList.remove("listening");
  };

  recognition.onerror = () => {
    startBtn.classList.remove("listening");
  };
}

function save() {
  const items = [];
  document.querySelectorAll("li").forEach(li => items.push(li.textContent));
  localStorage.setItem("schedules", JSON.stringify(items));
}

function load() {
  const data = JSON.parse(localStorage.getItem("schedules") || "[]");
  data.forEach(text => {
    const li = document.createElement("li");
    li.textContent = text;
    list.appendChild(li);
  });
}

load();

if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("service-worker.js");
}
</script>
</body>
</html>
